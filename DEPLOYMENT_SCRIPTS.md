# éƒ¨ç½²è„šæœ¬ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®æä¾›äº†ä¸¤ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼Œç”¨äºåœ¨ EC2 ä¸Šå¿«é€Ÿéƒ¨ç½²æœåŠ¡ï¼š

- `deploy_backend.sh` - Backend Service éƒ¨ç½²è„šæœ¬
- `deploy_agent.sh` - Agent Service éƒ¨ç½²è„šæœ¬

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

æ¯ä¸ªè„šæœ¬éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. âœ… **æ£€æŸ¥é¡¹ç›®ç›®å½•** - éªŒè¯é¡¹ç›®è·¯å¾„æ˜¯å¦å­˜åœ¨
2. âœ… **è®¾ç½® Tmux ç¯å¢ƒ** - åˆ›å»ºæˆ–è¿æ¥åˆ° tmux session
3. âœ… **æ‹‰å–æœ€æ–°ä»£ç ** - ä» Git ä»“åº“æ‹‰å–æœ€æ–°ä»£ç ï¼ˆè‡ªåŠ¨ stash æœ¬åœ°æ›´æ”¹ï¼‰
4. âœ… **é‡Šæ”¾ç«¯å£** - æ£€æŸ¥å¹¶åœæ­¢å ç”¨ç«¯å£çš„æ—§è¿›ç¨‹
5. âœ… **å®‰è£…/æ›´æ–°ä¾èµ–** - å®‰è£…æ‰€éœ€ä¾èµ–åŒ…
6. âœ… **å¯åŠ¨æœåŠ¡** - åœ¨ tmux ä¸­å¯åŠ¨æœåŠ¡

## ğŸ“¦ è„šæœ¬é…ç½®

### Backend Service (`deploy_backend.sh`)
- **ç«¯å£**: 8000
- **Tmux Session**: `hipet`
- **Tmux Window**: `backend`
- **å·¥ä½œç›®å½•**: `~/hipet-backend/backend-service`

### Agent Service (`deploy_agent.sh`)
- **ç«¯å£**: 8001
- **Tmux Session**: `hipet`
- **Tmux Window**: `agent`
- **å·¥ä½œç›®å½•**: `~/hipet-backend/agent-service`

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### é¦–æ¬¡éƒ¨ç½²

1. **ç¡®ä¿é¡¹ç›®å·²å…‹éš†**:
   ```bash
   cd ~
   git clone git@github.com-hipet-backend:kingsleyli920/hipet-backend.git
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**:
   ```bash
   # Backend Service
   cd ~/hipet-backend/backend-service
   cp env.example .env
   vim .env  # ç¼–è¾‘é…ç½®
   
   # Agent Service
   cd ~/hipet-backend/agent-service
   vim .env  # åˆ›å»ºå¹¶ç¼–è¾‘é…ç½®
   ```

3. **è¿è¡Œéƒ¨ç½²è„šæœ¬**:
   ```bash
   # éƒ¨ç½² Backend Service
   cd ~/hipet-backend
   ./deploy_backend.sh
   
   # éƒ¨ç½² Agent Service
   ./deploy_agent.sh
   ```

### æ›´æ–°éƒ¨ç½²

æ¯æ¬¡ä»£ç æ›´æ–°åï¼Œåªéœ€é‡æ–°è¿è¡Œå¯¹åº”çš„éƒ¨ç½²è„šæœ¬å³å¯ï¼š

```bash
cd ~/hipet-backend
./deploy_backend.sh
./deploy_agent.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ‹‰å–æœ€æ–°ä»£ç 
- åœæ­¢æ—§æœåŠ¡
- æ›´æ–°ä¾èµ–ï¼ˆå¦‚æœæœ‰å˜åŒ–ï¼‰
- å¯åŠ¨æ–°æœåŠ¡

## ğŸ‘€ æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# è¿æ¥åˆ° tmux session
tmux attach -t hipet

# åœ¨ tmux ä¸­åˆ‡æ¢ window:
# Ctrl+B ç„¶åæŒ‰æ•°å­—é”®åˆ‡æ¢ window
# æˆ– Ctrl+B, n (ä¸‹ä¸€ä¸ª) / Ctrl+B, p (ä¸Šä¸€ä¸ª)

# åˆ†ç¦» sessionï¼ˆæœåŠ¡ç»§ç»­è¿è¡Œï¼‰:
# Ctrl+B, d

# æŸ¥çœ‹æ‰€æœ‰ window:
# Ctrl+B, w
```

## ğŸ” éªŒè¯æœåŠ¡è¿è¡Œ

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo ss -tlnp | grep -E '8000|8001'

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8000/health/
curl http://localhost:8001/health/
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**: 
   - Backend Service éœ€è¦æœ‰æœ‰æ•ˆçš„ `.env` æ–‡ä»¶
   - Agent Service éœ€è¦æœ‰ `.env` æ–‡ä»¶ï¼Œå¹¶ä¸” `GOOGLE_APPLICATION_CREDENTIALS` æŒ‡å‘çš„æ–‡ä»¶å¿…é¡»å­˜åœ¨

2. **ç«¯å£å†²çª**: 
   - è„šæœ¬ä¼šè‡ªåŠ¨åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
   - å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å…¶ä»–è¿›ç¨‹å ç”¨

3. **ä¾èµ–å®‰è£…**:
   - é¦–æ¬¡è¿è¡Œä¼šå®‰è£…æ‰€æœ‰ä¾èµ–ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´
   - åç»­è¿è¡Œåªä¼šå®‰è£…æ–°å¢çš„ä¾èµ–

4. **ä»£ç æ›´æ”¹**:
   - è„šæœ¬ä¼šè‡ªåŠ¨ stash æœªæäº¤çš„æœ¬åœ°æ›´æ”¹
   - å¦‚æœæœ‰é‡è¦çš„æœ¬åœ°æ›´æ”¹ï¼Œè¯·åœ¨è¿è¡Œè„šæœ¬å‰æ‰‹åŠ¨æäº¤æˆ–å¤‡ä»½

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: è„šæœ¬æ‰§è¡Œæƒé™ä¸è¶³

```bash
chmod +x deploy_backend.sh deploy_agent.sh
```

### é—®é¢˜ 2: Git æ‹‰å–å¤±è´¥

æ£€æŸ¥ Deploy Key æ˜¯å¦æ­£ç¡®é…ç½®ï¼š
```bash
ssh -T git@github.com-hipet-backend
```

### é—®é¢˜ 3: ä¾èµ–å®‰è£…å¤±è´¥

æ‰‹åŠ¨æ£€æŸ¥å¹¶å®‰è£…ï¼š
```bash
# Backend
cd ~/hipet-backend/backend-service
bun install

# Agent
cd ~/hipet-backend/agent-service
pip3 install -r requirements.txt
```

### é—®é¢˜ 4: æœåŠ¡å¯åŠ¨å¤±è´¥

æŸ¥çœ‹ tmux æ—¥å¿—ï¼š
```bash
tmux attach -t hipet
# åˆ‡æ¢åˆ°å¯¹åº”çš„ window æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
```

### é—®é¢˜ 5: ç«¯å£ä»ç„¶è¢«å ç”¨

æ‰‹åŠ¨åœæ­¢è¿›ç¨‹ï¼š
```bash
# æŸ¥æ‰¾è¿›ç¨‹
sudo lsof -i :8000  # Backend
sudo lsof -i :8001  # Agent

# åœæ­¢è¿›ç¨‹
sudo kill -9 <PID>
```

## ğŸ“ è„šæœ¬æ‰§è¡Œé¡ºåºè¯´æ˜

è„šæœ¬çš„æ‰§è¡Œé¡ºåºç»è¿‡ä¼˜åŒ–ï¼Œç¡®ä¿éƒ¨ç½²æµç¨‹çš„å¯é æ€§ï¼š

1. **æ£€æŸ¥é¡¹ç›®ç›®å½•** - é¦–å…ˆéªŒè¯ç¯å¢ƒæ˜¯å¦æ­£ç¡®
2. **è®¾ç½® Tmux** - å‡†å¤‡è¿è¡Œç¯å¢ƒ
3. **æ‹‰å–ä»£ç ** - æ›´æ–°ä»£ç ï¼ˆåœ¨å®‰è£…ä¾èµ–ä¹‹å‰ï¼‰
4. **é‡Šæ”¾ç«¯å£** - åœæ­¢æ—§æœåŠ¡ï¼ˆåœ¨å®‰è£…ä¾èµ–ä¹‹å‰ï¼Œé¿å…ç«¯å£å†²çªï¼‰
5. **å®‰è£…ä¾èµ–** - ç¡®ä¿ä¾èµ–æ˜¯æœ€æ–°çš„
6. **å¯åŠ¨æœåŠ¡** - æœ€åå¯åŠ¨æœåŠ¡

è¿™ä¸ªé¡ºåºç¡®ä¿äº†ï¼š
- å…ˆæ›´æ–°ä»£ç å†å®‰è£…ä¾èµ–ï¼ˆä¾èµ–å¯èƒ½ä¸ä»£ç ç‰ˆæœ¬ç›¸å…³ï¼‰
- å…ˆåœæ­¢æ—§æœåŠ¡å†å®‰è£…ä¾èµ–ï¼ˆé¿å…èµ„æºå†²çªï¼‰
- ä¾èµ–å®‰è£…å®Œæˆåæ‰å¯åŠ¨æœåŠ¡ï¼ˆç¡®ä¿ç¯å¢ƒå®Œæ•´ï¼‰
